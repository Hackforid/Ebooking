# -*- coding: utf-8 -*-

import sys
import requests
import MySQLdb
import datetime
import random
import time

qunar_ota8 = (
    120210, 143198, 140137, 69723, 178714, 65323, 113416, 188225, 72242, 92041, 59596, 129340, 42842, 10232, 52276, 43901, 62585, 72956, 188229, 129827, 157435, 50902, 136660, 149031, 9015, 89242, 188232, 188233, 131256, 130972, 5053, 62963, 40311, 30636, 188250, 62684, 53627, 12001079, 188292, 109509, 67308, 9639, 27463, 10924, 76231, 138278, 140210, 100445, 160942, 41246, 78063, 100783, 6770, 128957, 183675, 146107, 63686, 27967, 81612, 81660, 188254, 85668, 188272, 129034, 93166, 188806, 66922, 165671, 6770, 5108, 188807, 188820, 60737, 188802, 4859, 17211, 31956, 35485, 41246, 49754, 53816, 60737, 1733, 6111, 7526, 12033, 12617, 22206, 28584, 35662, 38440, 41016, 43969, 76147, 85060, 125298, 136541, 143298, 452, 697, 1437, 1762, 2224, 3140, 9340, 10567, 10881, 11224, 14353, 16559, 20223, 21257, 22879, 23866, 25880, 27339, 38947, 41246, 41258, 43272, 43946, 44208, 45218, 46467, 47671, 47916, 48321, 48847, 50944, 50999, 51090, 51855, 58344, 58906, 58911, 59613, 59917, 61760, 62643, 63591, 67587, 68921, 71389, 73249, 75548, 76955, 77236, 79957, 81269, 90852, 93032, 95006, 95819, 96215, 96538, 96606, 98830, 98859, 99474, 100445, 101660, 101970, 106716, 108104, 109046, 115526, 117750, 119271, 121202, 121686, 122222, 122720, 126967, 134430, 134457, 134725, 134757, 135941, 137115, 138777, 141887, 142285, 144115, 145118, 145516, 148940, 152870, 154339, 155202, 157761, 159155, 160680, 160942, 162872, 162949, 163701, 165627, 165732, 166399, 169431, 171238, 172142, 173479, 173610, 174338, 174673, 177520, 178672, 179657, 179678, 181504, 183262, 183570, 188265, 188271, 188291, 188294, 188301, 188991, 189588, 189650, 189875, 179008, 190000, 140869, 97272, 101618, 104877, 188295, 188296, 149028, 93512, 72242, 131256, 9792, 26167, 50944, 77895, 23268, 11093, 45364, 45365, 69569, 91336, 303022, 18810, 23876, 29298, 106687, 179248, 188284, 188285, 54504, 72216, 75915, 102738, 154758, 188991, 6758, 6758, 37017, 47252, 70687, 107577, 133377, 187921, 129929, 113655, 12593, 98830, 116502, 122938,
    57185, 54300, 181184, 180778, 156162, 94622, 30404, 34667, 60227, 78600, 147207, 176977, 177284, 93512, 329797, 32457, 51074, 100592, 118389, 121202, 122056, 142285, 151823, 149031, 61229, 145185, 158540, 294328, 38941, 106029, 139376, 182146, 2246, 43593, 79512, 84740, 116311, 151346, 166507, 168829, 169320, 170604, 42027, 106165, 121486, 143438, 152021, 329876, 57709, 6770, 117869, 41016, 125298, 136541, 1762, 3140, 3140, 954, 105173, 112888, 146614, 184949, 329895, 329896, 329897, 1445, 13884, 61408, 64348, 76155, 82226, 101478, 105386, 106687, 113739, 114247, 130041, 131779, 134697, 140232, 177952, 181731, 188807, 189662, 14767, 19563, 38996, 61258, 63411, 82720, 136723, 228300, 282961, 324452, 163607, 64595, 329898, 27335, 57094, 94463, 104707, 107934, 109308, 110307, 122938, 176545, 181731, 189479, 319365, 10355, 12297, 14573, 16550, 16550, 19526, 22466, 22560, 37271, 54491, 58174, 61978, 68406, 69052, 69228, 69441, 79270, 88445, 93563, 95176, 108383, 114351, 116486, 123097, 126129, 129370, 136369, 148863, 152979, 164098, 166342, 175326, 177245, 179610, 180197, 181661, 185621, 189955, 199711, 243228, 300470, 308398, 329900, 139376, 329898, 154090, 197826, 217129, 249, 6692, 7641, 18349, 86205, 94602, 110368, 113757, 126278, 143209, 160680, 170893, 184672, 330976, 330992, 32804, 48649, 63857, 76305, 134885, 147546, 181849, 112342, 176602, 56255, 68001, 76744, 81877, 106288, 158378, 177919, 3140, 22709, 75548, 129463, 150727, 331672, 189874, 3301, 13409, 28696, 37068, 60154, 71212, 78090, 90659, 94016, 99913, 130144, 139409, 173938, 538, 34477, 94065, 101471, 118775, 122861, 149682, 152429, 189875, 269171, 295372, 313462, 139519, 37903, 18723, 40703, 42623, 49969, 52138, 61333, 64736, 73590, 74995, 85371, 87586, 93375, 95558, 97758, 139314, 141555, 142490, 146241, 176074, 231858, 331947, 331948, 6537, 7105, 17166, 21418, 27810, 55363, 79023, 84456, 87771, 126918, 132851, 163018, 181856, 184164, 289127, 331949, 331951, 109696, 261542, 19267, 161211, 142051, 238539, 127485, 184022, 60684, )

qunar_ota1112 = (
    120210, 143198, 140137, 69723, 178714, 65323, 113416, 188225, 72242, 92041, 59596, 129340, 42842, 10232, 52276, 43901, 62585, 72956, 188229, 129827, 157435, 50902, 136660, 149031, 9015, 89242, 188232, 188233, 131256, 130972, 5053, 62963, 40311, 30636, 188250, 62684, 53627, 12001079, 188292, 109509, 67308, 9639, 3906, 8302, 11931, 19024, 19129, 35257, 59956, 63440, 74365, 89242, 94370, 98882, 102077, 104707, 106671, 122718, 140869, 72642, 188249, 131256, 134325, 13884, 131779, 114247, 131779, 130041, 82226, 140232, 76155, 106687, 64348, 61408, 134697, 113739, 181731, 101478, 177952, 184213, 117869, 2026, 7823, 60985, 27463, 10924, 76231, 138278, 140210, 100445, 160942, 41246, 78063, 100783, 6770, 128957, 183675, 146107, 63686, 27967, 81612, 81660, 188254, 85668, 188272, 129034, 93166, 188806, 66922, 165671, 6770, 5108, 188807, 188820, 60737, 188802, 4859, 17211, 31956, 35485, 41246, 49754, 53816, 60737, 1733, 6111, 7526, 12033, 12617, 22206, 28584, 35662, 38440, 41016, 43969, 76147, 85060, 125298, 136541, 143298, 156206, 452, 697, 1437, 1762, 2224, 3140, 9340, 10567, 10881, 11224, 14353, 16559, 20223, 21257, 22879, 23866, 25880, 27339, 38947, 41246, 41258, 43272, 43946, 44208, 45218, 46467, 47671, 47916, 48321, 48847, 50944, 50999, 51090, 51855, 58344, 58906, 58911, 59613, 59917, 61760, 62643, 63591, 67587, 68921, 71389, 73249, 75548, 76955, 77236, 79957, 81269, 90852, 93032, 95006, 95819, 96215, 96538, 96606, 98830, 98859, 99474, 100445, 101660, 101970, 106716, 108104, 109046, 115526, 117750, 119271, 121202, 121686, 122222, 122720, 126967, 134430, 134457, 134725, 134757, 135941, 137115, 138777, 141887, 142285, 144115, 145118, 145516, 148940, 152870, 154339, 155202, 157761, 159155, 160680, 160942, 162872, 162949, 163701, 165627, 165732, 166399, 169431, 171238, 172142, 173479, 173610, 174338, 174673, 177520, 178672, 179657, 179678, 181504, 183262, 183570, 188265, 188271, 188291, 188294, 188301, 188991, 189588, 189650, 189875, 179008, 190000, 60985, 97272, 101618, 104877, 188295, 188296, 149028, 93512, 72242, 131256, 9792, 26167, 50944, 77895, 23268, 11093, 45364, 45365, 69569, 91336, 303022, 18810, 23876, 29298, 106687, 179248, 188284, 188285, 54504, 72216, 75915,
    102738, 154758, 188991, 6758, 6758, 37017, 47252, 70687, 107577, 133377, 187921, 129929, 113655, 12593, 98830, 116502, 122938, 57185, 54300, 181184, 180778, 156162, 94622, 30404, 34667, 60227, 78600, 147207, 176977, 177284, 93512, 329797, 32457, 51074, 100592, 118389, 121202, 122056, 142285, 151823, 149031, 61229, 145185, 158540, 294328, 38941, 106029, 139376, 182146, 2246, 43593, 79512, 84740, 116311, 151346, 166507, 168829, 169320, 170604, 42027, 106165, 121486, 143438, 152021, 329876, 57709, 6770, 117869, 41016, 125298, 136541, 1762, 3140, 3140, 954, 105173, 112888, 146614, 184949, 329895, 329896, 329897, 1445, 13884, 61408, 64348, 76155, 82226, 101478, 105386, 106687, 113739, 114247, 130041, 131779, 134697, 140232, 177952, 181731, 188807, 189662, 14767, 19563, 38996, 61258, 63411, 82720, 136723, 228300, 282961, 324452, 163607, 64595, 329898, 27335, 57094, 94463, 104707, 107934, 109308, 110307, 122938, 176545, 181731, 189479, 319365, 10355, 12297, 14573, 16550, 16550, 19526, 22466, 22560, 37271, 54491, 58174, 61978, 68406, 69052, 69228, 69441, 79270, 88445, 93563, 95176, 108383, 114351, 116486, 123097, 126129, 129370, 136369, 148863, 152979, 164098, 166342, 175326, 177245, 179610, 180197, 181661, 185621, 189955, 199711, 243228, 300470, 308398, 329900, 139376, 329898, 154090, 197826, 217129, 5207, 7304, 11904, 116982, 125726, 137274, 146606, 156206, 249, 6692, 7641, 18349, 86205, 94602, 110368, 113757, 126278, 143209, 160680, 170893, 184672, 330976, 330992, 32804, 48649, 63857, 76305, 134885, 147546, 181849, 112342, 176602, 56255, 68001, 76744, 81877, 106288, 158378, 177919, 3140, 22709, 75548, 129463, 150727, 331672, 189874, 3301, 13409, 28696, 37068, 60154, 71212, 78090, 90659, 94016, 99913, 130144, 139409, 173938, 538, 34477, 94065, 101471, 118775, 122861, 149682, 152429, 189875, 269171, 295372, 313462, 139519, 37903, 18723, 40703, 42623, 49969, 52138, 61333, 64736, 73590, 74995, 85371, 87586, 93375, 95558, 97758, 139314, 141555, 142490, 146241, 176074, 231858, 331947, 331948, 6537, 7105, 17166, 21418, 27810, 55363, 79023, 84456, 87771, 126918, 132851, 163018, 181856, 184164, 289127, 331949, 331951, 109696, 261542, 19267, 161211, 142051, 238539, 127485, 184022, 60684, )

taobao_ota2 = [
    55, 52, 117, 558, 46, 47, 53, 56, 123, 59, 566, 60, 63, 67, 70, 71, 72, 75, 76, 77, 78, 240, 34, 39, 81, 84, 118, 131, 132, 204, 717, 142, 143, 127, 565, 129, 130, 172, 194, 304, 51, 41, 863, 865, 864, 863, 865, 866, 852, 867, 874, 1237, 1238, 1241, 1239, 1233, 1231, 1235, 1255, 1234, 1232, 1240, 1271, 1270, 1264, 1315, 1319,
    1327, 1321, 1316, 1322, 1325, 1317, 1326, 1320, 1318, 1323, 1296, 1301, 1269, 1309, 1309, 1302, 1290, 1308, 1300, 1289, 1311, 1278, 1273, 1274, 1276, 1304, 1294, 1285, 1266, 1265, 1293, 1279, 1267, 1277, 1291, 1275, 1303, 1299, 1298, 1282, 1295, 1310, 1292, 1312, 1297, 1286, 1335, 1268, 1284, 1287, 1280, 1283, 1288, 1187, 1264, 1418, ]

OTA = [2, 4, 5, 8, 9, 11, 12, 14, 15]

#poi_db = MySQLdb.connect("rds0cb1gjhushogrgmf6a.mysql.rds.aliyuncs.com", "btw", "btwPassw0rd", "devine_poi")
#ebk_db = MySQLdb.connect("rds0cb1gjhushogrgmf6a.mysql.rds.aliyuncs.com", "btw", "btwPassw0rd", "devine_ebooking")
poi_db = MySQLdb.connect("10.163.118.152", "btw", "btw123", "devine_poi")
ebk_db = MySQLdb.connect("10.163.118.152", "btw", "btw123", "devine_ebooking")


def trans_poi_to_chain_hotel_ids(poi_main_hotel_ids):
    SQL = 'SELECT DISTINCT(chainHotelId) FROM hotelMapping WHERE mainHotelId IN {} AND chainId = 6'.format(poi_main_hotel_ids)
    cursor = poi_db.cursor()
    try:
        cursor.execute(SQL)
        result = cursor.fetchall()
    except Exception, e:
        raise e
    finally:
        cursor.close()

    return [id for id, in result]

def get_all_ebk_hotel_id():
    SQL = 'SELECT id FROM cooperateHotel'
    cursor = ebk_db.cursor()
    cursor.execute(SQL)
    result = cursor.fetchall()
    cursor.close()

    return [id for id, in result]

def push_hotel(hotel_id, ota2, ota8, ota1112):
    #url = 'http://10.168.234.38:9701/api/admin/ota/hotel/{}/modify'.format(hotel_id)
    url = 'http://ebookingtest.betterwood.com/api/admin/ota/hotel/{}/modify'.format(hotel_id)
    ota_ids = list(OTA)
    if hotel_id not in ota2:
        ota_ids.remove(2)
    if hotel_id not in ota8:
        ota_ids.remove(8)
    if hotel_id not in ota1112:
        ota_ids.remove(11)
        ota_ids.remove(12)

    json_args = {
            'ota_ids': ota_ids,
            }
    r = requests.put(url, json=json_args)
    if r.status_code != 200:
        raise Exception(r.text)
    resp = r.json()
    if resp['errcode'] != 0:
        print resp

def main():
    ota8 = trans_poi_to_chain_hotel_ids(qunar_ota8)
    ota1112 = trans_poi_to_chain_hotel_ids(qunar_ota1112)
    hotel_ids = get_all_ebk_hotel_id()

    for id in hotel_ids:
        push_hotel(id, taobao_ota2, ota8, ota1112)


if __name__ == '__main__':
    main()
